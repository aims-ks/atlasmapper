<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
		"http://www.w3.org/TR/html4/loose.dtd">
<!--
 *  This file is part of AtlasMapper server and clients.
 *
 *  Copyright (C) 2011 Australian Institute of Marine Science
 *
 *  Contact: Gael Lafond <g.lafond@aims.org.au>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="icon" type="image/png" href="../resources/favicon.png" />
		<title>Manual Override documentation</title>

		<style type="text/css">
			table {
				border-collapse: collapse;
				border: 1px solid #99BCE8;
				width: 100%;
			}
			table th, table td {
				vertical-align: top;
				padding: 0.2em;
			}
			table th {
				border: 1px solid #FFFFFF;
				background-color: #99BCE8;
			}
			table td {
				border: 1px solid #99BCE8;
			}
			table tr td.attr {
				font-family: monospace, sans-serif;
				width: 300px;
			}
			table tr .type {
				width: 100px;
			}
		</style>
	</head>

	<body>
		<h1>Manual Override documentation</h1>
		<p>
			This field must respect the JSON syntax, a subset of JavaScript. If
			it contains errors, the form will refuse to submit. It always start
			with <b>{</b> and ends with <b>}</b>. To override an attribute of a
			layer, specified the layer ID following by a column <b>:</b> and the
			curly brackets <b>{</b> and <b>}</b>. Add the attributes inside the
			brackets.
		</p>
		<p>
			The attributes for a layer are build from the capabilities document,
			for WMS layers, after applying the manual overrides from the layer
			data source than the manual overrides from the client.
		</p>
		<h2>Examples</h2>
		<p>
			The following bloc override the attribute
			<i>wmsRequestMimeType</i> and <i>legendParameters</i> for the
			layer ID <i>ea:bluemarble</i> of the datasource <i>ea</i> to request tiles and legend graphics as GIF:
		</p>
<pre>
{
	"ea_ea:bluemarble": {
		"wmsRequestMimeType": "image/gif",
		"legendParameters": {
			"FORMAT": "image/gif"
		}
	}
}
</pre>

		<p>
			This example show how to deactivate the feature requests for the
			layer ID <i>ea:GBR_GBRMPA_GBR-features</i> of the datasource <i>ea</i> and change the default style
			and change the title of an other one.
		</p>
<pre>
{
	"ea_ea:GBR_GBRMPA_GBR-features": {
		"wmsQueryable": false,
		"styles": {
			"GBR-features_Reefs-outline-BW": {"default": true},
			"GBR-features_Baselayer": {
				"title": "GBR features for baselayer"
			}
		}
	}
}
</pre>

		<p>
			The next example show how to disable the legend for multiple layers.
			This feature is useful for layer groups serve by GeoServer since
			this server can't provide legend graphics for grouped layers.
		</p>
<pre>
{
	"ea_GBR_JCU_Bathymetry-3DGBR_Land-and-sea": {"hasLegend": false},
	"ea_World_NE2-coast-cities-reefs_Baselayer": {"hasLegend": false},
	"ea_ea:World_NED_NE2": {"hasLegend": false}
}
</pre>

		<p>
			The <i>AtlasMapper</i> also allow the admin to setup custom <b>layer group</b>,
			that are added to the client as a single layer. That layer can be opened
			like a folder to set options on individual layers of the group. Since
			it is a client side group, each layers of the group has to be rendered
			separately on OpenLayers. It is advisable to keep the number of layers
			on a group bellow 5.
		</p>
		<p>
			<b>Layer groups</b> have the same attributes as normal layers, but has to
			be entirely configured since the layer do not exist on the server. The important
			attributes to set are:
		</p>
		<table>
			<tr>
				<th class="attr">Attribute</th>
				<th class="type">Value (example)</th>
				<th class="desc">Description</th>
			</tr>
			<tr>
				<td>dataSourceType</td>
				<td>"GROUP"</td>
				<td>To tell AtlasMapper that it's a layer group</td>
			</tr>

			<tr>
				<td>description</td>
				<td>"The layer's description"</td>
				<td>This is shown in the layer info panel</td>
			</tr>
			<tr>
				<td>layerBoundingBox</td>
				<td>[134.91053, -29.91797, 156.53147, -8.29703]</td>
				<td>The cumulated bounding box of all layers of the group, to enable the locate feature.</td>
			</tr>
			<tr>
				<td>layers</td>
				<td>["ea_ea:QLD_DEEDI_Coastal-wetlands", "ea_ea:QLD_DEEDI_Coastal-wetlands_Study-regions"]</td>
				<td>List of layers contained in the group, assuming they are provided by one of the data source of the client.</td>
			</tr>
			<tr>
				<td>title</td>
				<td>"Mangroves"</td>
				<td>The name of the layer, as it will appear in the layer list, either in the tree and in the layer switcher.</td>
			</tr>
			<tr>
				<td>version</td>
				<td>1.1</td>
				<td>This feature is only available with version 1.1 of the configuration standard.</td>
			</tr>
			<tr>
				<td>wmsPath</td>
				<td>"Terrestrial biology/Coastal wetlands"</td>
				<td>The layer group will appear under the folder <i>Terrestrial biology</i> &gt; <i>Coastal wetlands</i></td>
			</tr>
			<tr>
				<td>wmsQueryable</td>
				<td>false</td>
				<td>Layer groups are not currently queryable. If this setting is not set to false, OpenLayers will try to send request to a unregistered layer, which may cause some errors.</td>
			</tr>
		</table>
		<p>
			The following example set up a layer group titled <i>Mangroves</i>, having the following 2 layers:
			<i>ea_ea:QLD_DEEDI_Coastal-wetlands</i>, <i>ea_ea:QLD_DEEDI_Coastal-wetlands_Study-regions</i>
		</p>
<pre>
{
	"ea_mangroves": {
		"dataSourceType": "GROUP",
		"description": "Layer group for the layers \"QLD Coastal wetlands - Study regions\" and \"QLD Coastal wetlands (DEEDI)\"",
		"layerBoundingBox": [
			134.91053,
			-29.91797,
			156.53147,
			-8.29703
		],
		"layers": [
			"ea_ea:QLD_DEEDI_Coastal-wetlands",
			"ea_ea:QLD_DEEDI_Coastal-wetlands_Study-regions"
		],
		"title": "Mangroves",
		"version": 1.1,
		"wmsPath": "Terrestrial biology/Coastal wetlands",
		"wmsQueryable": false
	}
}
</pre>

		<p>
			The following table show the layers attributes that can be specified:
		</p>

		<table>
			<tr>
				<th class="attr">Attribute</th>
				<th class="type">Type</th>
				<th class="desc">Description</th>
			</tr>
			<tr>
				<td class="attr">title</td>
				<td class="type">String</td>
				<td class="desc">The displayed name of the layer, shown in multiple location in the client.</td>
			</tr>
			<tr>
				<td class="attr">description</td>
				<td class="type">HTML String</td>
				<td class="desc">A HTML description of the layer, shown in the layer info panel of the client.</td>
			</tr>
			<tr>
				<td class="attr">dataSourceId</td>
				<td class="type">String</td>
				<td class="desc">The ID of the data source, as specified in the data source page. This field can be used to specified which URL to use to get the tiles, legend, feature requests, etc.</td>
			</tr>
			<tr>
				<td class="attr">layerBoundingBox</td> <!-- TODO Is this field work? -->
				<td class="type">Array of 4 decimal numbers</td>
				<td class="desc">The coordinate of the top-left corner and the bottom left corder of the layer. Those coordinates are used to locate the layer when the <i>Locate</i> button is pressed.</td>
			</tr>
			<tr>
				<td class="attr">wmsQueryable</td>
				<td class="type">Boolean</td>
				<td class="desc"><i>true</i> to allow a layer to receive WMS Feature requests, <i>false</i> otherwise.</td>
			</tr>
			<tr>
				<td class="attr">isBaseLayer</td>
				<td class="type">Boolean</td>
				<td class="desc"><i>true</i> to make this layer a base layer, <i>false</i> otherwise. Note that it is better to use the <i>Base layers</i> field in the <i>Data sources</i> configuration page.</td>
			</tr>
			<tr>
				<td class="attr">hasLegend</td>
				<td class="type">Boolean</td>
				<td class="desc"><i>false</i> to disable the legend of this layer.</td>
			</tr>
			<tr>
				<td class="attr">legendUrl</td>
				<td class="type">URL</td>
				<td class="desc">URL to an image, to be use as a legend, to substitute the one provide by the server.</td>
			</tr>
			<tr>
				<td class="attr">legendGroup</td>
				<td class="type">String</td>
				<td class="desc">Name of the group that will be use to group legend together, in the legend window.</td>
			</tr>
			<tr>
				<td class="attr">legendTitle</td>
				<td class="type">String</td>
				<td class="desc">Name of the layer, to be display in the legend window.</td>
			</tr>
			<tr>
				<td class="attr">infoHtmlUrls</td> <!-- TODO Is this field work? -->
				<td class="type">Array of URL</td>
				<td class="desc">URLs of documents that will be displayed in the Layer info panel.</td>
			</tr>
			<tr>
				<td class="attr">layers</td>
				<td class="type">Array of String</td>
				<td class="desc">Used with <i>layer groups</i>. List of layers, added as children in the layer switcher, when adding this layer to the map.</td>
			</tr>
			<tr>
				<td class="attr">aliasIds</td> <!-- TODO Is this field still useful? -->
				<td class="type">Array of String</td>
				<td class="desc">List of IDs that can be used to refer to this layer.</td>
			</tr>
			<tr>
				<td class="attr">featureRequestsUrl</td>
				<td class="type">URL</td>
				<td class="desc">URL used to send the feature requests. Useful to redirect the feature requests of WebCache layers to a WMS server.</td>
			</tr>
			<tr>
				<td class="attr">serverUrls</td>
				<td class="type">Array of URL</td>
				<td class="desc">URL used to request the tiles. The application currently only support one URL. The first one only is used.</td>
			</tr>
			<tr>
				<td class="attr">webCacheUrl</td>
				<td class="type">URL</td>
				<td class="desc">URL of the server used to request the layer from a cache, when the URL only contains supported parameters.</td>
			</tr>
			<tr>
				<td class="attr">webCacheSupportedParameters</td>
				<td class="type">Array of String</td>
				<td class="desc">List of the parameters supported by the WebCache server.</td>
			</tr>
			<tr>
				<td class="attr">dataSourceName</td> <!-- TODO Is this field work? -->
				<td class="type">String</td>
				<td class="desc">Specified a different data source name for this layer, to display it in a different tab in the <i>Add layers</i> window.</td>
			</tr>
			<tr>
				<td class="attr">dataSourceType</td>
				<td class="type">String</td>
				<td class="desc">Override the type of layer. This option should not be used in normals circumstances, other that defining a <i>layer group</i>.</td>
			</tr>
			<tr>
				<td class="attr">legendParameters</td>
				<td class="type">String</td>
				<td class="desc">
					String of pairs <i>parameter=value</i>, separated by coma. Those parameters are sent with the request for the legend graphic.<br/>
					Example: The following will increase the font size and change the font colour of a GeoServer legend (those parameters are not standard)
<pre>
{
	"ea_ea:GBR_JCU_Bathymetry-3DGBR_Hillshade": {
		"legendParameters": "FORMAT=image/png,LEGEND_OPTIONS=fontColor:ff0000;fontSize:16"
	}
}
</pre>
					NOTE: To add/set legends parameters to all layers of a client, use the field <i>Legend parameters</i>, found bellow the <i>Layers' manual override</i> in the advanced tab.
				</td>
			</tr>
			<tr>
				<td class="attr">wmsFeatureRequestLayers</td>
				<td class="type">Array of Layer ID</td>
				<td class="desc">List of layers to be request when a feature request is sent to this layer.</td>
			</tr>
			<!-- TODO Enable this when transectable will be implemented
			<tr>
				<td class="attr">wmsTransectable</td>
				<td class="type">Boolean</td>
				<td class="desc"><i>true</i> to allow the client to draw transect on this layer, <i>false</i> otherwise.</td>
			</tr>
			-->
			<tr>
				<td class="attr">default</td>
				<td class="type">Boolean</td>
				<td class="desc"><i>true</i> to load this layer when the client load, <i>false</i> otherwise. (default value: false)</td>
			</tr>
			<tr>
				<td class="attr">styles</td>
				<td class="type">JSON Object</td>
				<td class="desc">
					Define the styles of this layer.<br/>
					List of available options for styles:
					<table>
						<tr>
							<th class="attr">Attribute</th>
							<th class="type">Type</th>
							<th class="desc">Description</th>
						</tr>
						<tr>
							<td class="attr">title</td>
							<td class="type">String</td>
							<td class="desc">The displayed name for this style. It's shown in the dropdown list in the option panel of the layer.</td>
						</tr>
						<tr>
							<td class="attr">description</td>
							<td class="type">String</td>
							<td class="desc">A description for the layer. This field currently has no use in the AtlasMapper client.</td>
						</tr>
						<tr>
							<td class="attr">default</td>
							<td class="type">Boolean</td>
							<td class="desc"><i>true</i> to load this style by default when the layer is loaded, <i>false</i> otherwise. (default value: false)</td>
						</tr>
					</table>
					For more info, check the example above or the styles' definition for a layer in the file <i>layers.json</i>.
				</td>
			</tr>
			<tr>
				<td class="attr">options</td>
				<td class="type">Array of JSON Object</td>
				<td class="desc">
					Define extra options to be added in the options panel of this layer.<br/>
					Example:<br/>
<pre>
"ea_ea:bluemarble" : {
	"options": [
		{
			"name": "comment",
			"title": "Comment",
			"type": "textarea"
		}
	]
}
</pre>
					<b>WARNING</b> this attribute is under development and may be unstable or change considerably between versions.<br/>
					List of available attributes for this field:
					<table>
						<tr>
							<td class="attr">name</td>
							<td class="type">String</td>
							<td class="desc">The parameter's name, added to the request.</td>
						</tr>
						<tr>
							<th class="attr">Attribute</th>
							<th class="type">Type</th>
							<th class="desc">Description</th>
						</tr>
						<tr>
							<td class="attr">title</td>
							<td class="type">String</td>
							<td class="desc">The displayed name for this option. It's shown as a label for the new input.</td>
						</tr>
						<tr>
							<td class="attr">type</td>
							<td class="type">String</td>
							<td class="desc">
								The ExtJS xtype for the input.<br/>
								List of available types:
								<ul>
									<li><b>checkbox</b></li>
									<li><b>combo</b>: for dropdown. Not supported yet.</li>
									<li><b>displayfield</b>: to display a readonly value.</li>
									<li><b>hidden</b>: to send a value to the server without showing it to the user.</li>
									<li><b>numberfield</b></li>
									<li><b>sliderfield</b></li>
									<li><b>textarea</b></li>
									<li><b>textfield</b></li>
									<li><b>timefield</b></li>
									<li><b>datefield</b>: For date in format d/m/Y</li>
									<li><b>ux-datefield</b>: For date displayed in format d/m/Y but sent to the server in format Y-m-d</li>
									<li><b>ux-ncdatetimefield</b>: For date and time displayed in format d/m/Y and saved in the ISO format expected by NCWMS server.</li>
									<li><b>ux-ncplotpanel</b>: To add time series and transect drawing features on NCWMS layers. NOTE: The <i>name</i> field is ignored with this type since it do not change the layer URL.</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td class="attr">mandatory</td>
							<td class="type">Boolean</td>
							<td class="desc"><i>true</i> to force the user to fill the option with a value, <i>false</i> otherwise. (default value: <i>false</i>)</td>
						</tr>
						<tr>
							<td class="attr">defaultValue</td>
							<td class="type">String</td>
							<td class="desc">Value pre-entered in the field.</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td class="attr">selected</td>
				<td class="type">Boolean</td>
				<td class="desc">
					<i>false</i> to add the layer in the layer switcher but not on the map (visibility false) when loaded for the first time.<br/>
					<b>NOTE:</b> This is a temporary field that will be removed after the Save State feature has been developed.
				</td>
			</tr>
			<tr>
				<td class="attr">shownOnlyInLayerGroup</td>
				<td class="type">Boolean</td>
				<td class="desc">
					<i>true</i> to hide the layer from the add layer tree. This is used with layers that are included in a layer group.
				</td>
			</tr>
			<tr>
				<td class="attr">cached</td>
				<td class="type">Boolean</td>
				<td class="desc">
					Default: <i>true</i>. Set to <i>false</i> if the layer should never be request to the cache (GWC).
				</td>
			</tr>
			<tr>
				<td class="attr">olParams</td>
				<td class="type">JSON Object</td>
				<td class="desc">
					Define the OGC URL parameters overrides.<br/>
					Some OpenLayers layer class has an attribute called params. Those params are used in the
					request to get the map images (usually tiles). They can be overridden by setting a value
					for <i>olParams</i>.<br/>
					For example, a layer can be request as a GIF using this override:
<pre>
"ea_ea:bluemarble" : {
	"olParams": {
		"format": "image/gif"
	}
}
</pre>
					See: <a href="http://nsidc.org/data/atlas/ogc_services.html#WMS">OGC WMS parameters</a>,
				</td>
			</tr>
			<tr>
				<td class="attr">olOptions</td>
				<td class="type">JSON Object</td>
				<td class="desc">
					Define the OpenLayers options overrides.<br/>
					All OpenLayers layer class has options. Those options can be overridden by setting a value for <i>olOptions</i>.<br/>
					For example, a layer can be request as a single tile, and be displayed at 50% opacity by default:
<pre>
"ea_ea:bluemarble" : {
	"olOptions": {
		"opacity": 0.5,
		"singleTile": true
	}
}
</pre>
					See: <a href="http://dev.openlayers.org/releases/OpenLayers-2.11/doc/apidocs/files/OpenLayers/Layer/Grid-js.html">OpenLayers Grid layer API</a>, list of <i>Properties</i>.
				</td>
			</tr>
			<!-- styles & layerOptions: [name, type, mandatory, defaultValue] -->
			<tr>
				<td class="attr">wmsVersion</td>
				<td class="type">String</td>
				<td class="desc"><b>DEPRECATED by <i>"olParams": {"version": "1.1.1"}</i></b><br/>The WMS version send in the request; "1.1.1", "1.3.0"</td>
			</tr>
			<tr>
				<td class="attr">wmsRequestMimeType</td>
				<td class="type">Mime type</td>
				<td class="desc"><b>DEPRECATED by <i>"olParams": {"format": "image/png"}</i></b><br/>Mime type used to request the tiles. Usualy <i>image/jpeg</i>, <i>image/png</i> or <i>image/gif</i></td>
			</tr>
		</table>
	</body>
</html>
